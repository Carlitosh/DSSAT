test_that("Single profile",{

  withr::with_file("TEST.SOL",{
    write(
      c("*SOILS: General DSSAT Soil Input File",
        "",
        "*IB00000001  IBSNAT      SIC     210 DEFAULT - DEEP SILTY CLAY",
        "@SITE        COUNTRY          LAT     LONG SCS FAMILY",
        " Generic     Generic          -99      -99 Generic",
        "@ SCOM  SALB  SLU1  SLDR  SLRO  SLNF  SLPF  SMHB  SMPX  SMKE",
        "   -99  0.11   6.0  0.30  85.0  1.00  1.00 IB001 IB001 IB001",
        "@  SLB  SLMH  SLLL  SDUL  SSAT  SRGF  SSKS  SBDM  SLOC  SLCL  SLSI  SLCF  SLNI  SLHW  SLHB  SCEC  SADC",
        "     5   -99 0.228 0.385 0.481 1.000   -99  1.30  1.75  50.0  45.0   0.0 0.170   6.5   -99   -99   -99 ",
        "    15   -99 0.228 0.385 0.481 1.000   -99  1.30  1.75  50.0  45.0   0.0 0.170   6.5   -99   -99   -99 ",
        "    30   -99 0.249 0.406 0.482 0.638   -99  1.30  1.60  50.0  45.0   0.0 0.170   6.5   -99   -99   -99 ",
        "    45   -99 0.249 0.406 0.465 0.472   -99  1.35  1.45  50.0  45.0   0.0 0.140   6.5   -99   -99   -99 ",
        "    60   -99 0.249 0.406 0.465 0.350   -99  1.35  1.45  50.0  45.0   0.0 0.140   6.5   -99   -99   -99 ",
        "    90   -99 0.308 0.456 0.468 0.223   -99  1.35  1.10  50.0  45.0   0.0 0.110   6.5   -99   -99   -99 ",
        "   120   -99 0.207 0.341 0.452 0.122   -99  1.40  0.65  50.0  45.0   0.0 0.060   6.5   -99   -99   -99 ",
        "   150   -99 0.243 0.365 0.455 0.067   -99  1.40  0.30  50.0  45.0   0.0 0.030   6.5   -99   -99   -99 ",
        "   180   -99 0.259 0.361 0.457 0.037   -99  1.40  0.10  50.0  45.0   0.0 0.010   6.5   -99   -99   -99 ",
        "   210   -99 0.259 0.361 0.457 0.020   -99  1.40  0.01  50.0  45.0   0.0 0.000   6.5   -99   -99   -99 ",
        ""),
      "TEST.SOL"
      )

    sol <- DSSAT::read_sol("TEST.SOL")

  })

  DSSAT:::test_cols_check(
    sol,
    char_cols = c("PEDON", "SOURCE", "TEXTURE", "DESCRIPTION",
                  "SITE", "COUNTRY", "SCS FAMILY", "SCOM",
                  "SMHB", "SMPX", "SMKE", "SLMH"),
    list_cols = c("SLB", "SLMH", "SLLL", "SDUL", "SSAT",
                  "SRGF", "SSKS", "SBDM", "SLOC", "SLCL",
                  "SLSI", "SLCF", "SLNI", "SLHW", "SLHB",
                  "SCEC", "SADC"),
    expected_vals = list(PEDON = "IB00000001",
                         SOURCE = "IBSNAT",
                         TEXTURE = "SIC",
                         DEPTH = 210,
                         DESCRIPTION = "DEFAULT - DEEP SILTY CLAY",
                         SITE = "Generic",
                         COUNTRY = "Generic",
                         LAT = NA_real_,
                         LONG = NA_real_,
                         "SCS FAMILY" = "Generic",
                         SCOM = NA_character_,
                         SALB = 0.11,
                         SLU1 = 6,
                         SLDR = 0.3,
                         SLRO = 85,
                         SLNF = 1,
                         SLPF = 1,
                         SMHB = "IB001",
                         SMPX = "IB001",
                         SMKE = "IB001",
                         SLB = list(c(5, 15, 30, 45, 60, 90,
                                      120, 150, 180, 210)),
                         SLMH = list(c(NA_character_, NA_character_,
                                       NA_character_, NA_character_,
                                       NA_character_, NA_character_,
                                       NA_character_, NA_character_,
                                       NA_character_, NA_character_)),
                         SLLL = list(c(0.228, 0.228, 0.249, 0.249,
                                       0.249, 0.308, 0.207, 0.243,
                                       0.259, 0.259)),
                         SDUL = list(c(0.385, 0.385, 0.406, 0.406,
                                       0.406, 0.456, 0.341, 0.365,
                                       0.361, 0.361)),
                         SSAT = list(c(0.481, 0.481, 0.482, 0.465,
                                       0.465, 0.468, 0.452, 0.455,
                                       0.457, 0.457)),
                         SRGF = list(c(1, 1, 0.638, 0.472, 0.35,
                                       0.223, 0.122, 0.067,
                                       0.037, 0.02)),
                         SSKS = list(c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_)),
                         SBDM = list(c(1.3, 1.3, 1.3, 1.35,
                                       1.35, 1.35, 1.4, 1.4,
                                       1.4, 1.4)),
                         SLOC = list(c(1.75, 1.75, 1.6, 1.45,
                                       1.45, 1.1, 0.65, 0.3,
                                       0.1, 0.01)),
                         SLCL = list(c(50, 50, 50, 50, 50,
                                       50, 50, 50, 50, 50)),
                         SLSI = list(c(45, 45, 45, 45, 45,
                                       45, 45, 45, 45, 45)),
                         SLCF = list(c(0, 0, 0, 0, 0, 0,
                                       0, 0, 0, 0)),
                         SLNI = list(c(0.17, 0.17, 0.17, 0.14,
                                       0.14, 0.11, 0.06, 0.03,
                                       0.01, 0)),
                         SLHW = list(c(6.5, 6.5, 6.5, 6.5,
                                       6.5, 6.5, 6.5, 6.5,
                                       6.5, 6.5)),
                         SLHB = list(c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_)),
                         SCEC = list(c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_)),
                         SADC = list(c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_)))
  )

})


test_that("Three profiles",{

  withr::with_file("TEST.SOL",{
    write(
      c("*SOILS: General DSSAT Soil Input File",
        "",
        "*IB00000001  IBSNAT      SIC     210 DEFAULT - DEEP SILTY CLAY",
        "@SITE        COUNTRY          LAT     LONG SCS FAMILY",
        " Generic     Generic          -99      -99 Generic",
        "@ SCOM  SALB  SLU1  SLDR  SLRO  SLNF  SLPF  SMHB  SMPX  SMKE",
        "   -99  0.11   6.0  0.30  85.0  1.00  1.00 IB001 IB001 IB001",
        "@  SLB  SLMH  SLLL  SDUL  SSAT  SRGF  SSKS  SBDM  SLOC  SLCL  SLSI  SLCF  SLNI  SLHW  SLHB  SCEC  SADC",
        "     5   -99 0.228 0.385 0.481 1.000   -99  1.30  1.75  50.0  45.0   0.0 0.170   6.5   -99   -99   -99 ",
        "    15   -99 0.228 0.385 0.481 1.000   -99  1.30  1.75  50.0  45.0   0.0 0.170   6.5   -99   -99   -99 ",
        "    30   -99 0.249 0.406 0.482 0.638   -99  1.30  1.60  50.0  45.0   0.0 0.170   6.5   -99   -99   -99 ",
        "    45   -99 0.249 0.406 0.465 0.472   -99  1.35  1.45  50.0  45.0   0.0 0.140   6.5   -99   -99   -99 ",
        "    60   -99 0.249 0.406 0.465 0.350   -99  1.35  1.45  50.0  45.0   0.0 0.140   6.5   -99   -99   -99 ",
        "    90   -99 0.308 0.456 0.468 0.223   -99  1.35  1.10  50.0  45.0   0.0 0.110   6.5   -99   -99   -99 ",
        "   120   -99 0.207 0.341 0.452 0.122   -99  1.40  0.65  50.0  45.0   0.0 0.060   6.5   -99   -99   -99 ",
        "   150   -99 0.243 0.365 0.455 0.067   -99  1.40  0.30  50.0  45.0   0.0 0.030   6.5   -99   -99   -99 ",
        "   180   -99 0.259 0.361 0.457 0.037   -99  1.40  0.10  50.0  45.0   0.0 0.010   6.5   -99   -99   -99 ",
        "   210   -99 0.259 0.361 0.457 0.020   -99  1.40  0.01  50.0  45.0   0.0 0.000   6.5   -99   -99   -99 ",
        "",
        "*IB00000002  IBSNAT      SIC     150 DEFAULT - MEDIUM SILTY CLAY",
        "@SITE        COUNTRY          LAT     LONG SCS FAMILY",
        " Generic     Generic          -99      -99 Generic",
        "@ SCOM  SALB  SLU1  SLDR  SLRO  SLNF  SLPF  SMHB  SMPX  SMKE",
        "   -99  0.11   6.0  0.20  87.0  1.00  1.00 IB001 IB001 IB001",
        "@  SLB  SLMH  SLLL  SDUL  SSAT  SRGF  SSKS  SBDM  SLOC  SLCL  SLSI  SLCF  SLNI  SLHW  SLHB  SCEC  SADC",
        "     5   -99 0.228 0.385 0.463 1.000   -99  1.35  1.74  50.0  45.0   0.0 0.170   6.5   -99   -99   -99 ",
        "    15   -99 0.228 0.385 0.463 1.000   -99  1.35  1.74  50.0  45.0   0.0 0.170   6.5   -99   -99   -99 ",
        "    30   -99 0.228 0.385 0.459 0.638   -99  1.36  1.66  50.0  45.0   0.0 0.170   6.5   -99   -99   -99 ",
        "    45   -99 0.249 0.406 0.461 0.472   -99  1.36  1.45  50.0  45.0   0.0 0.140   6.5   -99   -99   -99 ",
        "    60   -99 0.249 0.406 0.461 0.350   -99  1.36  1.45  50.0  45.0   0.0 0.140   6.5   -99   -99   -99 ",
        "    90   -99 0.308 0.449 0.460 0.223   -99  1.37  1.09  50.0  45.0   0.0 0.110   6.5   -99   -99   -99 ",
        "   120   -99 0.207 0.341 0.460 0.122   -99  1.38  0.65  50.0  45.0   0.0 0.060   6.5   -99   -99   -99 ",
        "   150   -99 0.256 0.373 0.463 0.067   -99  1.38  0.29  50.0  45.0   0.0 0.030   6.5   -99   -99   -99 ",
        "",
        "*IB00000003  IBSNAT      SIC      60 DEFAULT - SHALLOW SILTY CLAY",
        "@SITE        COUNTRY          LAT     LONG SCS FAMILY",
        " Generic     Generic          -99      -99 Generic",
        "@ SCOM  SALB  SLU1  SLDR  SLRO  SLNF  SLPF  SMHB  SMPX  SMKE",
        "   -99  0.11   6.0  0.10  89.0  1.00  1.00 IB001 IB001 IB001",
        "@  SLB  SLMH  SLLL  SDUL  SSAT  SRGF  SSKS  SBDM  SLOC  SLCL  SLSI  SLCF  SLNI  SLHW  SLHB  SCEC  SADC",
        "     5   -99 0.228 0.385 0.463 1.000   -99  1.35  1.74  50.0  45.0   0.0 0.170   6.5   -99   -99   -99 ",
        "    15   -99 0.228 0.385 0.463 1.000   -99  1.35  1.74  50.0  45.0   0.0 0.170   6.5   -99   -99   -99 ",
        "    30   -99 0.228 0.385 0.459 0.638   -99  1.36  1.66  50.0  45.0   0.0 0.170   6.5   -99   -99   -99 ",
        "    45   -99 0.249 0.406 0.461 0.472   -99  1.36  1.45  50.0  45.0   0.0 0.140   6.5   -99   -99   -99 ",
        "    60   -99 0.249 0.406 0.461 0.350   -99  1.36  1.45  50.0  45.0   0.0 0.140   6.5   -99   -99   -99 ",
        ""),
      "TEST.SOL"
      )

    sol <- DSSAT::read_sol("TEST.SOL")

  })

  DSSAT:::test_cols_check(
    sol,
    char_cols = c("PEDON", "SOURCE", "TEXTURE", "DESCRIPTION",
                  "SITE", "COUNTRY", "SCS FAMILY", "SCOM",
                  "SMHB", "SMPX", "SMKE", "SLMH"),
    list_cols = c("SLB", "SLMH", "SLLL", "SDUL", "SSAT",
                  "SRGF", "SSKS", "SBDM", "SLOC", "SLCL",
                  "SLSI", "SLCF", "SLNI", "SLHW", "SLHB",
                  "SCEC", "SADC"),
    expected_vals = list(PEDON = c("IB00000001", "IB00000002",
                                   "IB00000003"),
                         SOURCE = c("IBSNAT", "IBSNAT", "IBSNAT"),
                         TEXTURE = c("SIC", "SIC", "SIC"),
                         DEPTH = c(210, 150, 60),
                         DESCRIPTION = c("DEFAULT - DEEP SILTY CLAY",
                                         "DEFAULT - MEDIUM SILTY CLAY",
                                         "DEFAULT - SHALLOW SILTY CLAY"),
                         SITE = c("Generic", "Generic", "Generic"),
                         COUNTRY = c("Generic", "Generic", "Generic"),
                         LAT = c(NA_real_, NA_real_, NA_real_),
                         LONG = c(NA_real_, NA_real_, NA_real_),
                         "SCS FAMILY" = c("Generic", "Generic",
                                          "Generic"),
                         SCOM = c(NA_character_, NA_character_,
                                  NA_character_),
                         SALB = c(0.11, 0.11, 0.11),
                         SLU1 = c(6, 6, 6),
                         SLDR = c(0.3, 0.2, 0.1),
                         SLRO = c(85, 87, 89),
                         SLNF = c(1, 1, 1),
                         SLPF = c(1, 1, 1),
                         SMHB = c("IB001", "IB001", "IB001"),
                         SMPX = c("IB001", "IB001", "IB001"),
                         SMKE = c("IB001", "IB001", "IB001"),
                         SLB = list(c(5, 15, 30, 45, 60, 90,
                                      120, 150, 180, 210),
                                    c(5, 15, 30, 45, 60, 90,
                                      120, 150),
                                    c(5, 15, 30, 45, 60)),
                         SLMH = list(c(NA_character_, NA_character_,
                                       NA_character_, NA_character_,
                                       NA_character_, NA_character_,
                                       NA_character_, NA_character_,
                                       NA_character_, NA_character_),
                                     c(NA_character_, NA_character_,
                                       NA_character_, NA_character_,
                                       NA_character_, NA_character_,
                                       NA_character_, NA_character_),
                                     c(NA_character_, NA_character_,
                                       NA_character_, NA_character_,
                                       NA_character_)),
                         SLLL = list(c(0.228, 0.228, 0.249, 0.249,
                                       0.249, 0.308, 0.207, 0.243,
                                       0.259, 0.259),
                                     c(0.228, 0.228, 0.228, 0.249,
                                       0.249, 0.308, 0.207, 0.256),
                                     c(0.228, 0.228, 0.228, 0.249,
                                       0.249)),
                         SDUL = list(c(0.385, 0.385, 0.406,
                                       0.406, 0.406, 0.456,
                                       0.341, 0.365, 0.361,
                                       0.361),
                                     c(0.385, 0.385, 0.385,
                                       0.406, 0.406, 0.449,
                                       0.341, 0.373),
                                     c(0.385, 0.385, 0.385,
                                       0.406, 0.406)),
                         SSAT = list(c(0.481, 0.481, 0.482,
                                       0.465, 0.465, 0.468,
                                       0.452, 0.455, 0.457,
                                       0.457),
                                     c(0.463, 0.463, 0.459,
                                       0.461, 0.461, 0.46,
                                       0.46, 0.463),
                                     c(0.463, 0.463, 0.459,
                                       0.461, 0.461)),
                         SRGF = list(c(1, 1, 0.638, 0.472,
                                       0.35, 0.223, 0.122,
                                       0.067, 0.037, 0.02),
                                     c(1, 1, 0.638, 0.472,
                                       0.35, 0.223, 0.122,
                                       0.067),
                                     c(1, 1, 0.638, 0.472,
                                       0.35)),
                         SSKS = list(c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_),
                                     c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_),
                                     c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_)),
                         SBDM = list(c(1.3, 1.3, 1.3, 1.35,
                                       1.35, 1.35, 1.4, 1.4,
                                       1.4, 1.4),
                                     c(1.35, 1.35, 1.36, 1.36,
                                       1.36, 1.37, 1.38, 1.38),
                                     c(1.35, 1.35, 1.36, 1.36,
                                       1.36)),
                         SLOC = list(c(1.75, 1.75, 1.6, 1.45,
                                       1.45, 1.1, 0.65, 0.3,
                                       0.1, 0.01),
                                     c(1.74, 1.74, 1.66, 1.45,
                                       1.45, 1.09, 0.65, 0.29),
                                     c(1.74, 1.74, 1.66, 1.45,
                                       1.45)),
                         SLCL = list(c(50, 50, 50, 50, 50, 50,
                                       50, 50, 50, 50),
                                     c(50, 50, 50, 50, 50, 50,
                                       50, 50),
                                     c(50, 50, 50, 50, 50)),
                         SLSI = list(c(45, 45, 45, 45, 45, 45,
                                       45, 45, 45, 45),
                                     c(45, 45, 45, 45, 45, 45,
                                       45, 45),
                                     c(45, 45, 45, 45, 45)),
                         SLCF = list(c(0, 0, 0, 0, 0, 0, 0,
                                       0, 0, 0),
                                     c(0, 0, 0, 0, 0, 0,
                                       0, 0),
                                     c(0, 0, 0, 0, 0)),
                         SLNI = list(c(0.17, 0.17, 0.17,
                                       0.14, 0.14, 0.11,
                                       0.06, 0.03, 0.01, 0),
                                     c(0.17, 0.17, 0.17,
                                       0.14, 0.14, 0.11,
                                       0.06, 0.03),
                                     c(0.17, 0.17, 0.17,
                                       0.14, 0.14)),
                         SLHW = list(c(6.5, 6.5, 6.5, 6.5,
                                       6.5, 6.5, 6.5, 6.5,
                                       6.5, 6.5),
                                     c(6.5, 6.5, 6.5, 6.5,
                                       6.5, 6.5, 6.5, 6.5),
                                     c(6.5, 6.5, 6.5, 6.5,
                                       6.5)),
                         SLHB = list(c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_),
                                     c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_),
                                     c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_)),
                         SCEC = list(c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_),
                                     c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_),
                                     c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_)),
                         SADC = list(c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_),
                                     c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_),
                                     c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_)))
  )

})
test_that("Single profile read_sol_fast()",{

  withr::with_file("TEST.SOL",{
    write(
      c("*SOILS: General DSSAT Soil Input File",
        "",
        "*IB00000001  IBSNAT      SIC     210 DEFAULT - DEEP SILTY CLAY",
        "@SITE        COUNTRY          LAT     LONG SCS FAMILY",
        " Generic     Generic          -99      -99 Generic",
        "@ SCOM  SALB  SLU1  SLDR  SLRO  SLNF  SLPF  SMHB  SMPX  SMKE",
        "   -99  0.11   6.0  0.30  85.0  1.00  1.00 IB001 IB001 IB001",
        "@  SLB  SLMH  SLLL  SDUL  SSAT  SRGF  SSKS  SBDM  SLOC  SLCL  SLSI  SLCF  SLNI  SLHW  SLHB  SCEC  SADC",
        "     5   -99 0.228 0.385 0.481 1.000   -99  1.30  1.75  50.0  45.0   0.0 0.170   6.5   -99   -99   -99 ",
        "    15   -99 0.228 0.385 0.481 1.000   -99  1.30  1.75  50.0  45.0   0.0 0.170   6.5   -99   -99   -99 ",
        "    30   -99 0.249 0.406 0.482 0.638   -99  1.30  1.60  50.0  45.0   0.0 0.170   6.5   -99   -99   -99 ",
        "    45   -99 0.249 0.406 0.465 0.472   -99  1.35  1.45  50.0  45.0   0.0 0.140   6.5   -99   -99   -99 ",
        "    60   -99 0.249 0.406 0.465 0.350   -99  1.35  1.45  50.0  45.0   0.0 0.140   6.5   -99   -99   -99 ",
        "    90   -99 0.308 0.456 0.468 0.223   -99  1.35  1.10  50.0  45.0   0.0 0.110   6.5   -99   -99   -99 ",
        "   120   -99 0.207 0.341 0.452 0.122   -99  1.40  0.65  50.0  45.0   0.0 0.060   6.5   -99   -99   -99 ",
        "   150   -99 0.243 0.365 0.455 0.067   -99  1.40  0.30  50.0  45.0   0.0 0.030   6.5   -99   -99   -99 ",
        "   180   -99 0.259 0.361 0.457 0.037   -99  1.40  0.10  50.0  45.0   0.0 0.010   6.5   -99   -99   -99 ",
        "   210   -99 0.259 0.361 0.457 0.020   -99  1.40  0.01  50.0  45.0   0.0 0.000   6.5   -99   -99   -99 ",
        ""),
      "TEST.SOL"
    )

    sol <- DSSAT:::read_sol_fast("TEST.SOL")

  })

  DSSAT:::test_cols_check(
    sol,
    char_cols = c("PEDON", "SOURCE", "TEXTURE", "DESCRIPTION",
                  "SITE", "COUNTRY", "SCS FAMILY", "SCOM",
                  "SMHB", "SMPX", "SMKE", "SLMH"),
    list_cols = c("SLB", "SLMH", "SLLL", "SDUL", "SSAT",
                  "SRGF", "SSKS", "SBDM", "SLOC", "SLCL",
                  "SLSI", "SLCF", "SLNI", "SLHW", "SLHB",
                  "SCEC", "SADC"),
    expected_vals = list(PEDON = "IB00000001",
                         SOURCE = "IBSNAT",
                         TEXTURE = "SIC",
                         DEPTH = 210,
                         DESCRIPTION = "DEFAULT - DEEP SILTY CLAY",
                         SITE = "Generic",
                         COUNTRY = "Generic",
                         LAT = NA_real_,
                         LONG = NA_real_,
                         "SCS FAMILY" = "Generic",
                         SCOM = NA_character_,
                         SALB = 0.11,
                         SLU1 = 6,
                         SLDR = 0.3,
                         SLRO = 85,
                         SLNF = 1,
                         SLPF = 1,
                         SMHB = "IB001",
                         SMPX = "IB001",
                         SMKE = "IB001",
                         SLB = list(c(5, 15, 30, 45, 60, 90,
                                      120, 150, 180, 210)),
                         SLMH = list(c(NA_character_, NA_character_,
                                       NA_character_, NA_character_,
                                       NA_character_, NA_character_,
                                       NA_character_, NA_character_,
                                       NA_character_, NA_character_)),
                         SLLL = list(c(0.228, 0.228, 0.249, 0.249,
                                       0.249, 0.308, 0.207, 0.243,
                                       0.259, 0.259)),
                         SDUL = list(c(0.385, 0.385, 0.406, 0.406,
                                       0.406, 0.456, 0.341, 0.365,
                                       0.361, 0.361)),
                         SSAT = list(c(0.481, 0.481, 0.482, 0.465,
                                       0.465, 0.468, 0.452, 0.455,
                                       0.457, 0.457)),
                         SRGF = list(c(1, 1, 0.638, 0.472, 0.35,
                                       0.223, 0.122, 0.067,
                                       0.037, 0.02)),
                         SSKS = list(c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_)),
                         SBDM = list(c(1.3, 1.3, 1.3, 1.35,
                                       1.35, 1.35, 1.4, 1.4,
                                       1.4, 1.4)),
                         SLOC = list(c(1.75, 1.75, 1.6, 1.45,
                                       1.45, 1.1, 0.65, 0.3,
                                       0.1, 0.01)),
                         SLCL = list(c(50, 50, 50, 50, 50,
                                       50, 50, 50, 50, 50)),
                         SLSI = list(c(45, 45, 45, 45, 45,
                                       45, 45, 45, 45, 45)),
                         SLCF = list(c(0, 0, 0, 0, 0, 0,
                                       0, 0, 0, 0)),
                         SLNI = list(c(0.17, 0.17, 0.17, 0.14,
                                       0.14, 0.11, 0.06, 0.03,
                                       0.01, 0)),
                         SLHW = list(c(6.5, 6.5, 6.5, 6.5,
                                       6.5, 6.5, 6.5, 6.5,
                                       6.5, 6.5)),
                         SLHB = list(c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_)),
                         SCEC = list(c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_)),
                         SADC = list(c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_)))
  )

})


test_that("Three profiles read_sol_fast()",{

  withr::with_file("TEST.SOL",{
    write(
      c("*SOILS: General DSSAT Soil Input File",
        "",
        "*IB00000001  IBSNAT      SIC     210 DEFAULT - DEEP SILTY CLAY",
        "@SITE        COUNTRY          LAT     LONG SCS FAMILY",
        " Generic     Generic          -99      -99 Generic",
        "@ SCOM  SALB  SLU1  SLDR  SLRO  SLNF  SLPF  SMHB  SMPX  SMKE",
        "   -99  0.11   6.0  0.30  85.0  1.00  1.00 IB001 IB001 IB001",
        "@  SLB  SLMH  SLLL  SDUL  SSAT  SRGF  SSKS  SBDM  SLOC  SLCL  SLSI  SLCF  SLNI  SLHW  SLHB  SCEC  SADC",
        "     5   -99 0.228 0.385 0.481 1.000   -99  1.30  1.75  50.0  45.0   0.0 0.170   6.5   -99   -99   -99 ",
        "    15   -99 0.228 0.385 0.481 1.000   -99  1.30  1.75  50.0  45.0   0.0 0.170   6.5   -99   -99   -99 ",
        "    30   -99 0.249 0.406 0.482 0.638   -99  1.30  1.60  50.0  45.0   0.0 0.170   6.5   -99   -99   -99 ",
        "    45   -99 0.249 0.406 0.465 0.472   -99  1.35  1.45  50.0  45.0   0.0 0.140   6.5   -99   -99   -99 ",
        "    60   -99 0.249 0.406 0.465 0.350   -99  1.35  1.45  50.0  45.0   0.0 0.140   6.5   -99   -99   -99 ",
        "    90   -99 0.308 0.456 0.468 0.223   -99  1.35  1.10  50.0  45.0   0.0 0.110   6.5   -99   -99   -99 ",
        "   120   -99 0.207 0.341 0.452 0.122   -99  1.40  0.65  50.0  45.0   0.0 0.060   6.5   -99   -99   -99 ",
        "   150   -99 0.243 0.365 0.455 0.067   -99  1.40  0.30  50.0  45.0   0.0 0.030   6.5   -99   -99   -99 ",
        "   180   -99 0.259 0.361 0.457 0.037   -99  1.40  0.10  50.0  45.0   0.0 0.010   6.5   -99   -99   -99 ",
        "   210   -99 0.259 0.361 0.457 0.020   -99  1.40  0.01  50.0  45.0   0.0 0.000   6.5   -99   -99   -99 ",
        "",
        "*IB00000002  IBSNAT      SIC     150 DEFAULT - MEDIUM SILTY CLAY",
        "@SITE        COUNTRY          LAT     LONG SCS FAMILY",
        " Generic     Generic          -99      -99 Generic",
        "@ SCOM  SALB  SLU1  SLDR  SLRO  SLNF  SLPF  SMHB  SMPX  SMKE",
        "   -99  0.11   6.0  0.20  87.0  1.00  1.00 IB001 IB001 IB001",
        "@  SLB  SLMH  SLLL  SDUL  SSAT  SRGF  SSKS  SBDM  SLOC  SLCL  SLSI  SLCF  SLNI  SLHW  SLHB  SCEC  SADC",
        "     5   -99 0.228 0.385 0.463 1.000   -99  1.35  1.74  50.0  45.0   0.0 0.170   6.5   -99   -99   -99 ",
        "    15   -99 0.228 0.385 0.463 1.000   -99  1.35  1.74  50.0  45.0   0.0 0.170   6.5   -99   -99   -99 ",
        "    30   -99 0.228 0.385 0.459 0.638   -99  1.36  1.66  50.0  45.0   0.0 0.170   6.5   -99   -99   -99 ",
        "    45   -99 0.249 0.406 0.461 0.472   -99  1.36  1.45  50.0  45.0   0.0 0.140   6.5   -99   -99   -99 ",
        "    60   -99 0.249 0.406 0.461 0.350   -99  1.36  1.45  50.0  45.0   0.0 0.140   6.5   -99   -99   -99 ",
        "    90   -99 0.308 0.449 0.460 0.223   -99  1.37  1.09  50.0  45.0   0.0 0.110   6.5   -99   -99   -99 ",
        "   120   -99 0.207 0.341 0.460 0.122   -99  1.38  0.65  50.0  45.0   0.0 0.060   6.5   -99   -99   -99 ",
        "   150   -99 0.256 0.373 0.463 0.067   -99  1.38  0.29  50.0  45.0   0.0 0.030   6.5   -99   -99   -99 ",
        "",
        "*IB00000003  IBSNAT      SIC      60 DEFAULT - SHALLOW SILTY CLAY",
        "@SITE        COUNTRY          LAT     LONG SCS FAMILY",
        " Generic     Generic          -99      -99 Generic",
        "@ SCOM  SALB  SLU1  SLDR  SLRO  SLNF  SLPF  SMHB  SMPX  SMKE",
        "   -99  0.11   6.0  0.10  89.0  1.00  1.00 IB001 IB001 IB001",
        "@  SLB  SLMH  SLLL  SDUL  SSAT  SRGF  SSKS  SBDM  SLOC  SLCL  SLSI  SLCF  SLNI  SLHW  SLHB  SCEC  SADC",
        "     5   -99 0.228 0.385 0.463 1.000   -99  1.35  1.74  50.0  45.0   0.0 0.170   6.5   -99   -99   -99 ",
        "    15   -99 0.228 0.385 0.463 1.000   -99  1.35  1.74  50.0  45.0   0.0 0.170   6.5   -99   -99   -99 ",
        "    30   -99 0.228 0.385 0.459 0.638   -99  1.36  1.66  50.0  45.0   0.0 0.170   6.5   -99   -99   -99 ",
        "    45   -99 0.249 0.406 0.461 0.472   -99  1.36  1.45  50.0  45.0   0.0 0.140   6.5   -99   -99   -99 ",
        "    60   -99 0.249 0.406 0.461 0.350   -99  1.36  1.45  50.0  45.0   0.0 0.140   6.5   -99   -99   -99 ",
        ""),
      "TEST.SOL"
    )

    sol <- DSSAT:::read_sol_fast("TEST.SOL")

  })

  DSSAT:::test_cols_check(
    sol,
    char_cols = c("PEDON", "SOURCE", "TEXTURE", "DESCRIPTION",
                  "SITE", "COUNTRY", "SCS FAMILY", "SCOM",
                  "SMHB", "SMPX", "SMKE", "SLMH"),
    list_cols = c("SLB", "SLMH", "SLLL", "SDUL", "SSAT",
                  "SRGF", "SSKS", "SBDM", "SLOC", "SLCL",
                  "SLSI", "SLCF", "SLNI", "SLHW", "SLHB",
                  "SCEC", "SADC"),
    expected_vals = list(PEDON = c("IB00000001", "IB00000002",
                                   "IB00000003"),
                         SOURCE = c("IBSNAT", "IBSNAT", "IBSNAT"),
                         TEXTURE = c("SIC", "SIC", "SIC"),
                         DEPTH = c(210, 150, 60),
                         DESCRIPTION = c("DEFAULT - DEEP SILTY CLAY",
                                         "DEFAULT - MEDIUM SILTY CLAY",
                                         "DEFAULT - SHALLOW SILTY CLAY"),
                         SITE = c("Generic", "Generic", "Generic"),
                         COUNTRY = c("Generic", "Generic", "Generic"),
                         LAT = c(NA_real_, NA_real_, NA_real_),
                         LONG = c(NA_real_, NA_real_, NA_real_),
                         "SCS FAMILY" = c("Generic", "Generic",
                                          "Generic"),
                         SCOM = c(NA_character_, NA_character_,
                                  NA_character_),
                         SALB = c(0.11, 0.11, 0.11),
                         SLU1 = c(6, 6, 6),
                         SLDR = c(0.3, 0.2, 0.1),
                         SLRO = c(85, 87, 89),
                         SLNF = c(1, 1, 1),
                         SLPF = c(1, 1, 1),
                         SMHB = c("IB001", "IB001", "IB001"),
                         SMPX = c("IB001", "IB001", "IB001"),
                         SMKE = c("IB001", "IB001", "IB001"),
                         SLB = list(c(5, 15, 30, 45, 60, 90,
                                      120, 150, 180, 210),
                                    c(5, 15, 30, 45, 60, 90,
                                      120, 150),
                                    c(5, 15, 30, 45, 60)),
                         SLMH = list(c(NA_character_, NA_character_,
                                       NA_character_, NA_character_,
                                       NA_character_, NA_character_,
                                       NA_character_, NA_character_,
                                       NA_character_, NA_character_),
                                     c(NA_character_, NA_character_,
                                       NA_character_, NA_character_,
                                       NA_character_, NA_character_,
                                       NA_character_, NA_character_),
                                     c(NA_character_, NA_character_,
                                       NA_character_, NA_character_,
                                       NA_character_)),
                         SLLL = list(c(0.228, 0.228, 0.249, 0.249,
                                       0.249, 0.308, 0.207, 0.243,
                                       0.259, 0.259),
                                     c(0.228, 0.228, 0.228, 0.249,
                                       0.249, 0.308, 0.207, 0.256),
                                     c(0.228, 0.228, 0.228, 0.249,
                                       0.249)),
                         SDUL = list(c(0.385, 0.385, 0.406,
                                       0.406, 0.406, 0.456,
                                       0.341, 0.365, 0.361,
                                       0.361),
                                     c(0.385, 0.385, 0.385,
                                       0.406, 0.406, 0.449,
                                       0.341, 0.373),
                                     c(0.385, 0.385, 0.385,
                                       0.406, 0.406)),
                         SSAT = list(c(0.481, 0.481, 0.482,
                                       0.465, 0.465, 0.468,
                                       0.452, 0.455, 0.457,
                                       0.457),
                                     c(0.463, 0.463, 0.459,
                                       0.461, 0.461, 0.46,
                                       0.46, 0.463),
                                     c(0.463, 0.463, 0.459,
                                       0.461, 0.461)),
                         SRGF = list(c(1, 1, 0.638, 0.472,
                                       0.35, 0.223, 0.122,
                                       0.067, 0.037, 0.02),
                                     c(1, 1, 0.638, 0.472,
                                       0.35, 0.223, 0.122,
                                       0.067),
                                     c(1, 1, 0.638, 0.472,
                                       0.35)),
                         SSKS = list(c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_),
                                     c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_),
                                     c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_)),
                         SBDM = list(c(1.3, 1.3, 1.3, 1.35,
                                       1.35, 1.35, 1.4, 1.4,
                                       1.4, 1.4),
                                     c(1.35, 1.35, 1.36, 1.36,
                                       1.36, 1.37, 1.38, 1.38),
                                     c(1.35, 1.35, 1.36, 1.36,
                                       1.36)),
                         SLOC = list(c(1.75, 1.75, 1.6, 1.45,
                                       1.45, 1.1, 0.65, 0.3,
                                       0.1, 0.01),
                                     c(1.74, 1.74, 1.66, 1.45,
                                       1.45, 1.09, 0.65, 0.29),
                                     c(1.74, 1.74, 1.66, 1.45,
                                       1.45)),
                         SLCL = list(c(50, 50, 50, 50, 50, 50,
                                       50, 50, 50, 50),
                                     c(50, 50, 50, 50, 50, 50,
                                       50, 50),
                                     c(50, 50, 50, 50, 50)),
                         SLSI = list(c(45, 45, 45, 45, 45, 45,
                                       45, 45, 45, 45),
                                     c(45, 45, 45, 45, 45, 45,
                                       45, 45),
                                     c(45, 45, 45, 45, 45)),
                         SLCF = list(c(0, 0, 0, 0, 0, 0, 0,
                                       0, 0, 0),
                                     c(0, 0, 0, 0, 0, 0,
                                       0, 0),
                                     c(0, 0, 0, 0, 0)),
                         SLNI = list(c(0.17, 0.17, 0.17,
                                       0.14, 0.14, 0.11,
                                       0.06, 0.03, 0.01, 0),
                                     c(0.17, 0.17, 0.17,
                                       0.14, 0.14, 0.11,
                                       0.06, 0.03),
                                     c(0.17, 0.17, 0.17,
                                       0.14, 0.14)),
                         SLHW = list(c(6.5, 6.5, 6.5, 6.5,
                                       6.5, 6.5, 6.5, 6.5,
                                       6.5, 6.5),
                                     c(6.5, 6.5, 6.5, 6.5,
                                       6.5, 6.5, 6.5, 6.5),
                                     c(6.5, 6.5, 6.5, 6.5,
                                       6.5)),
                         SLHB = list(c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_),
                                     c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_),
                                     c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_)),
                         SCEC = list(c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_),
                                     c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_),
                                     c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_)),
                         SADC = list(c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_),
                                     c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_, NA_real_),
                                     c(NA_real_, NA_real_,
                                       NA_real_, NA_real_,
                                       NA_real_)))
  )

})
